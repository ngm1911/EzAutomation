<Window x:Class="AutomationTool.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:local="clr-namespace:AutomationTool" xmlns:helper="clr-namespace:AutomationTool.Helper" xmlns:hc="https://handyorg.github.io/handycontrol" xmlns:vm="clr-namespace:AutomationTool.ViewModel" xmlns:i="http://schemas.microsoft.com/xaml/behaviors" mc:Ignorable="d" Title="MainWindow" Height="550" Width="800">
    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>
    <DockPanel LastChildFill="True">
        <Border DockPanel.Dock="Top" BorderBrush="LightGray" BorderThickness="1" Margin="5" CornerRadius="4">
            <DockPanel LastChildFill="False">
                
                <StackPanel HorizontalAlignment="Left" Margin="5" IsEnabled="{Binding EnableFeature}">
                    <StackPanel Orientation="Horizontal">
                        <Button Command="{Binding AddItemCommand}" CommandParameter="{Binding SelectedGroup}" BorderBrush="Transparent" DockPanel.Dock="Right" Height="70" Width="70" ToolTip="New process">
                            <StackPanel>
                                <Image Source="/Icon/Add.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Add new" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding DeleteItemCommand}" CommandParameter="{Binding SelectedGroup}" Height="70" Width="70" BorderBrush="Transparent" ToolTip="Remove process">
                            <StackPanel>
                                <Image Source="/Icon/Delete.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Delete" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding SaveCommand}" DockPanel.Dock="Right" Height="70" Width="70" BorderBrush="Transparent" ToolTip="Save process">
                            <StackPanel>
                                <Image Source="/Icon/Save.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Save" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding DataContext.RenameCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                CommandParameter="{Binding SelectedGroup}"
                                DockPanel.Dock="Right" Height="70" Width="70" BorderBrush="Transparent" ToolTip="Rename process">
                            <StackPanel>
                                <Image Source="/Icon/Edit.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Rename" HorizontalAlignment="Center"/>
                            </StackPanel>

                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                    <Setter Property="IsEnabled" Value="True"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedGroup.IsEditing}" Value="True">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                    <TextBlock Text="Edit" HorizontalAlignment="Center"/>
                </StackPanel>
                <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5,0,5"/>
                <StackPanel HorizontalAlignment="Left" Margin="5" IsEnabled="{Binding EnableFeature}">
                    <StackPanel Orientation="Horizontal">
                        <Button Command="{Binding CopyItemCommand}" CommandParameter="{Binding SelectedGroup}" DockPanel.Dock="Right" BorderBrush="Transparent" Height="70" Width="70" ToolTip="Copy process">
                            <StackPanel>
                                <Image Source="/Icon/Copy.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Copy" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding PasteItemCommand}" CommandParameter="{Binding SelectedGroup}" DockPanel.Dock="Right" BorderBrush="Transparent" Height="70" Width="70" ToolTip="Paste process">
                            <StackPanel>
                                <Image Source="/Icon/Paste.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Paste" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    <TextBlock Text="Duplicate" HorizontalAlignment="Center"/>
                </StackPanel>
                <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5,0,5"/>
                <StackPanel HorizontalAlignment="Left" Margin="5" IsEnabled="{Binding EnableFeature}">
                    <StackPanel Height="70">
                        <Button ToolTip="Move up" Command="{Binding DataContext.UpStepCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                CommandParameter="{Binding SelectedGroup}" Height="30" Width="70" Padding="0,-5,0,-5" Margin="0,5,0,0"
                                BorderBrush="Transparent" VerticalAlignment="Center">
                            <StackPanel>
                                <Image Source="/Icon/Up.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button ToolTip="Move down" Command="{Binding DataContext.DownStepCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                CommandParameter="{Binding SelectedGroup}" Height="30" Width="70" Padding="0,-5,0,0"
                                BorderBrush="Transparent" VerticalAlignment="Center">
                            <StackPanel>
                                <Image Source="/Icon/Up.png" Width="32" Height="32" Margin="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Image.RenderTransform>
                                        <RotateTransform Angle="180" CenterX="16" CenterY="16"/>
                                    </Image.RenderTransform>
                                </Image>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    <TextBlock Text="Move" HorizontalAlignment="Center"/>
                </StackPanel>
                <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5,0,5"/>
                <StackPanel HorizontalAlignment="Left" Margin="5" IsEnabled="{Binding EnableFeature}">
                    <StackPanel Orientation="Horizontal">
                        <Button Command="{Binding RunCommand}" CommandParameter="{Binding}" VerticalAlignment="Top" 
                                BorderBrush="Transparent" Height="70" Width="70">
                            <StackPanel>
                                <Image Source="/Icon/Start.png" Width="32" Height="32" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Text="Start" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    <TextBlock Text="Automation" HorizontalAlignment="Center"/>
                </StackPanel>
                <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5,0,5"/>
            </DockPanel>
        </Border>        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="3"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <DockPanel Grid.Column="0" LastChildFill="True">
                <TreeView Margin="5" x:Name="treeView" SelectedItemChanged="treeView_SelectedItemChanged" ItemsSource="{Binding AutoTree}" MouseDoubleClick="TreeView_MouseDoubleClick">
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                        </Style>
                    </TreeView.ItemContainerStyle>
                    <TreeView.ContextMenu>
                        <ContextMenu Width="120">
                            <MenuItem Header="Collapse All" Click="btnCollapseAll_Click" Margin="-20,0,0,0"/>
                            <MenuItem Header="Expand All" Click="btnExpandAll_Click" Margin="-20,0,0,0"/>
                        </ContextMenu>
                    </TreeView.ContextMenu>
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Margin="3">
                                <DockPanel>
                                    <Image Width="18" Height="18" Stretch="Uniform" Margin="2,0,3,0">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Status}" Value="Passed">
                                                        <Setter Property="Source" Value="/Icon/Check.png"/>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Error">
                                                        <Setter Property="Source" Value="/Icon/Alert.png"/>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Setter Property="ToolTip" Value="{Binding Error}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="Running">
                                                        <Setter Property="Source" Value="/Icon/Loading.png"/>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                    <CheckBox IsChecked="{Binding Selected}" Margin="0,0,5,0"/>
                                    <TextBlock x:Name="txbGroupName" Text="{Binding Name}" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBox x:Name="txtGroupName" Margin="0,0,2,0" Text="{Binding Name}" VerticalAlignment="Center">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                </DockPanel>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </DockPanel>
            <GridSplitter Grid.Column="1" Width="3" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Gray" ShowsPreview="True"/>
            <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="4" Margin="5" Grid.Column="2" >
                <TabControl x:Name="tabControl" Margin="2">
                    <TabControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <StackPanel.ContextMenu>
                                    <ContextMenu Width="120">
                                        <MenuItem Header="Close all" Click="btnCloseAllTab_Click" Margin="-20,0,0,0"/>
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <TextBlock Text="{Binding Name}" Margin="0,0,5,0"/>
                                <Button x:Name="btnCloseTab" Click="btnCloseTab_Click" BorderThickness="0" Padding="0" Width="12" Height="12" VerticalAlignment="Center">
                                    <Image Source="/Icon/Close.png" Width="10" Height="10"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </TabControl.ItemTemplate>
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <DockPanel LastChildFill="True">
                                <DataGrid ItemsSource="{Binding Steps}" SelectionMode="Single" SelectionUnit="FullRow" AutoGenerateColumns="False" CanUserSortColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn>
                                            <DataGridTemplateColumn.HeaderTemplate>
                                                <DataTemplate>
                                                    <hc:ButtonGroup>
                                                        <Button DockPanel.Dock="Right" Command="{Binding DataContext.SaveCommand, RelativeSource={RelativeSource AncestorType=Window}}" ToolTip="Save process">
                                                            <Image Source="/Icon/Save.png" Width="16" Height="16"/>
                                                        </Button>
                                                        <Button DockPanel.Dock="Right" Command="{Binding DataContext.AddStepCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" ToolTip="Add step">
                                                            <Image Source="/Icon/Add.png" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Button>
                                                    </hc:ButtonGroup>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.HeaderTemplate>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <hc:ButtonGroup>
                                                        <Button BorderBrush="Transparent" Padding="4" Command="{Binding DataContext.ExcuteStepCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}" ToolTip="Excute step">
                                                            <Image Source="/Icon/Start.png" Width="16" Height="16"/>
                                                        </Button>
                                                        <Button BorderBrush="Transparent" Padding="2" ToolTip="Move up" Command="{Binding DataContext.UpStepCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                            <Image Source="/Icon/Up.png" Width="16" Height="16"/>
                                                        </Button>
                                                        <Button BorderBrush="Transparent" Padding="2" ToolTip="Move down" Command="{Binding DataContext.DownStepCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                            <Image Source="/Icon/Up.png" Width="16" Height="16">
                                                                <Image.RenderTransform>
                                                                    <RotateTransform Angle="180" CenterX="8" CenterY="8"/>
                                                                </Image.RenderTransform>
                                                            </Image>
                                                        </Button>
                                                        <Button BorderBrush="Transparent" Padding="4" Command="{Binding DataContext.RemoveStepCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                            <Image Source="/Icon/Delete.png" Width="16" Height="16"/>
                                                        </Button>
                                                        <Button BorderBrush="Transparent" Padding="4" Command="{Binding DataContext.CheckElementCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                                            <Image Source="/Icon/Point.png" Width="16" Height="16"/>
                                                        </Button>
                                                    </hc:ButtonGroup>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Status">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Image Width="20" Height="20" Stretch="Uniform">
                                                        <Image.Style>
                                                            <Style TargetType="Image">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Passed">
                                                                        <Setter Property="Source" Value="/Icon/Check.png"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Error">
                                                                        <Setter Property="Source" Value="/Icon/Alert.png"/>
                                                                        <Setter Property="ToolTip" Value="{Binding Error}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Running">
                                                                        <Setter Property="Source" Value="/Icon/Loading.png"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Control">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ControlType}">
                                                        <TextBlock.ContextMenu>
                                                            <ContextMenu Width="120">
                                                                <MenuItem Header="Clear cache" Margin="-20,0,0,0" Command="{Binding ClearCacheCommand}"/>
                                                            </ContextMenu>
                                                        </TextBlock.ContextMenu>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <hc:ComboBox ItemsSource="{Binding ControlItemSource}" SelectedItem="{Binding ControlType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Action">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ActionType}">
                                                        <TextBlock.ContextMenu>
                                                            <ContextMenu Width="120">
                                                                <MenuItem Header="Clear cache" Margin="-20,0,0,0" Command="{Binding ClearCacheCommand}"/>
                                                            </ContextMenu>
                                                        </TextBlock.ContextMenu>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <hc:ComboBox ItemsSource="{Binding ActionItemSource}" SelectedItem="{Binding ActionType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Width="200" Header="Param 0" Binding="{Binding Param0, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        <DataGridTextColumn Width="200" Header="Param 1" Binding="{Binding Param1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        <DataGridTextColumn Width="150" Header="Param 2" Binding="{Binding Param2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        <DataGridTextColumn Width="70" Header="Param 3" Binding="{Binding Param3}" Visibility="Collapsed"/>
                                        <DataGridTextColumn Width="70" Header="Param 4" Binding="{Binding Param4}" Visibility="Collapsed"/>
                                        <DataGridCheckBoxColumn Header="SkipError" Binding="{Binding SkipError}"/>
                                        <DataGridTextColumn Header="Notes" Binding="{Binding Name}"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </DockPanel>
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                </TabControl>
            </Border>
        </Grid>
    </DockPanel>
</Window>
